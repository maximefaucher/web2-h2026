
# Entrées en console avec Node.js

En Node.js, la saisie console se fait via le flux `process.stdin`, que le module `readline` simplifie.

## 1. Le module `readline`

Il s'agit de la méthode **la plus utilisée** et **celle qui est recommandée**.

### Références

- Voir la [documentation officielle de `readline`](https://nodejs.org/api/readline.html).
- [`callback` sur le MDN](https://developer.mozilla.org/fr/docs/Glossary/Callback_function)
- [Promesse ou `Promise`](https://developer.mozilla.org/fr/docs/Glossary/Promise)
- [Opérateur `await`](https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Operators/await)

Pour utiliser `readline`, on doit compléter les étapes suivantes :

1. Importation du module
2. Instanciation d'une interface du module
3. Utiliser l'instance créee avec ses méthodes

### 1.1 Approche 1 - `readline` avec `callback`

#### DÉFINITION : `callback`

Un *callback* (**fonction de rappel**) est une **fonction passée en argument à une autre fonction**, qui sera exécutée plus tard, souvent après qu'une tâche asynchrone (comme une requête réseau ou un clic d'utilisateur) soit terminée, permettant ainsi de gérer des opérations non bloquantes et de personnaliser le comportement d'une fonction sans connaître le code spécifique à l'avance. C'est un concept fondamental en programmation événementielle et asynchrone, notamment en JavaScript et Node.js.

#### SYNTAXE : `readline` avec `callback`

`readline.question(query[, options], callback);`

|Paramètre|Type|Statut|Rôle|
|---|---|---|---|
|`query`|`<string>`|Obligatoire|Question pour laquelle on veut une réponse (saisie)|
|`options`|`<Object>`|Optionnel|Permet éventuellement à `.question()` d'être annulée en utilisant un `AbortController`|
|`callback`|`<Function>`|Obligatoire|Une fonction de rappel qui est invoquée lorsque soumet l'entrée en réponse à la `query`|

#### EXEMPLES : `readline` avec `callback`

##### Exemple 1 - Une seule saisie

```javascript
// 1. IMPORTATION
import * as readline from 'node:readline';
// 2. INSTANCIATION
const rl = readline.createInterface({
    input: process.stdin,   // Flux Entrée
    output: process.stdout, // Flux Sortie
});
// 3. UTILISATION
rl.question("Quelle est votre couleur préférée? ", (reponse) => {
    console.log(`Le ${reponse} est une très belle couleur!`);
    rl.close(); // on ferme l'interface et libère les flux E/S
});
```

##### Exemple 2 - Plusieurs saisies

REMARQUE : Puisque la méthode `question()` est **asynchrone**, le `callback` est invoqué seulement lorsque la saisie est complétée. Ainsi, pour effectuer plusieurs saisies de façon **consécutives** (une APRÈS l'autre), on doit **chaîner** les appels à `question()`.

```javascript
// 1. IMPORTATION
import * as readline from 'node:readline';
// 2. INSTANCIATION
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
});
// 3. UTILISATION
rl.question("Quelle est votre couleur préférée? ", (reponse1) => {
    rl.question("Quelle est votre animal préféré? ", (reponse2) => {
        console.log(`Wow, le beau ${reponse2} de couleur ${reponse1}!`);
        rl.close(); // on ferme l'interface et libère les flux E/S (quand toutes les saisies sont faites)
    });
});
```

### 1.2 Approche 2 - `readline` avec promesse et `await`

#### DÉFINITION : Promesse

Une `Promise` est un **objet retourné par une fonction n'ayant pas encore terminé son travail** (asynchrone). La promesse représente littéralement une promesse faite par la fonction qui retournera éventuellement un résultat à travers l'objet promesse.

Une `Promise` est dans un de ces états :

- `pending` (en attente) : état initial, la promesse n'est ni tenue, ni rompue;
- `fulfilled` (tenue) : l'opération a réussi;
- `rejected` (rompue) : l'opération a échoué.

Une promesse en attente peut être **tenue avec une valeur** ou **rompue avec une raison** (erreur).

#### EXEMPLES : `readline` avec `Promise` et `await`

##### Exemple 1 - Plusieurs saisies

```javascript
// 1. IMPORTATION
import * as readline from 'node:readline/promises';
// importation (du module), le `/promises` permet l'utilisation de `await`
// 2. INSTANCIATION
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
});
// 3. UTILISATION
const nom = await rl.question("Ton nom ? "); // await pour attendre la réponse avant de poursuivre
const age = await rl.question("Ton âge ? ");
console.log(`Bonjour ${nom}!`);
console.log(`Dans ${100 - age}, vous aurez 100 ans!`);
rl.close(); // on ferme l'interface et libère les flux E/S (quand toutes les saisies sont faites)
```
